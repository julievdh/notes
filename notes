20 july 2017
- rest5envelopes_exh to do exhales only. audited hua 5' rest file separate inhales, exhales. detect peak, 95% energy duration. correlate with SUMMARYDATA from pneumotach. 

21 july 2017
- try above with hoku and kolohe 5' rest files 
- audited to separate exh from inh: 153b, 153c
- realigned files after auditing
- hoku (153b, DQ file 14): works fairly well, still some spikes in envelope, correlation not so clean. Need Resp Timing
- Kolohe (153c, DQ file 15): works fairly well, correlation ehh. Have resp timing.
- Did RESPTIMING for Hua, Hoku. Saved in _resp.mat files 
- DQ ECG data checks: which are good, which are not, which have undergone final check

23 july 2017
- working on ECG data final check for Andreas. 140z and 141y still have to finish

24 july 2017
- rest5envelopes
- found error in plotting for rest5envelopes: wasn't plotting integral of env (duplicate plots in subplot!) 
- integrated audited exhale, too. added to subplot. 
- run for files 13, 14, 15
- had to reaudit Lono 5'rest for exhales only, realigned with exhale only CUE 
- evalcorr.m to evaluate correlation. BUT need to flip correlation x and y: use sound to estimate pneum
- audited all ECG except 141y. Are there two overlapping signals, one lower Freq and one higher Freq? Ughhhhh

10 Aug 2017 [back from vacation]
- added RMSE to evalcorr
- switched axes for regression: use sound to estimate measured params (rest5envelopes_exh)
- fixed RESPTIMING for 153a - overestimated exhalation duration. * still have to do for 153b, 153c * 

11 Aug 2017
- Fixed RESPTIMING for 153b, 153c; re-ran rest5envelopes_exh
- Looked at Trial44 ChestBand, waiting until meeting with Peter and Kristian Monday. 
- Audited gm15_266a for breath counts (and revived surfDetect.m!)

14 Aug 2017
- Finished gm15_266a audit
- Met with Kristian and Peter re: Chest Band and other data. 

15 Aug 2017
- Other ECG files for Andreas: 136z, 144z, 146z [even though poor quality recordings]
- ChestBand Trial22: reselected band peaks, new calculation of prominence
- Calibrated other ChestBand pneumo files, exported, ran through DOLPHIN_FLOW_MR_jvdH. Emailed Austin re: Trial 36. Still have to export-run 60 and 61, but calibrated. 

23 Aug 2017
- ECG waterfall separation to correlate HR magnitude and VT for Andreas - file 138z
- set up directories for Animove 

24 Aug 2017
- SNAK course seminars; got Azores sperm whale data from Pernille, set up directories on PC

12 Sept 2017
- Animove: timestamp issues with Jakob via email for MoveVis
- Mapped out BreathCounts pipeline, checked data for upcoming analysis
- Audited gm15_265a

13 Sept 2017
- Updated gm13_220b audit (overwritten by accident, saved to C:\tag\audit)
- Completed gm13_220b, gm15_265a audits
- Met with Pernille re: sperm whale data
- Click detection for sw193a complete

14 Sept 2017
- Fix duplicate audits cues in breath counts
- Joyplot for breathcounts, including transparency etc. 
- Assign species, colours for breathcounts (assignSpp.m, assignCol.m), new colormap scaled with size
- Set 1s threshold between breaths, removed duplicate breaths.

15 Sept 2017
- Fixed first line CSV problem
- Used real data in PGLS
- Auditing gm11_248c
- Good example of breathing surfacing gm11_248c - screenshot and wav

16 Sept 2017
- Worked on resp detector to see detection rate/false alarm rate for short surfacings. False error rate still high. 
- Finished audit gm11_248c
- ggjoy with log(IBI) all individuals, just BEAUTIFUL. 

17 Sept 2017
- Plotting ggjoy log axes, NEW WEIGHT ESTIMATES

---- Biologging ----
---- Inertial Sensing Course ----

9 Oct 2017 
- Chest Band application to three files. File 61 best. Change to exhale only?

10 Oct 2017
- Tried exhale only, also looked at rest5min again.

12 Oct 2017
- Compared correlation of raw signal vs cleaned signal vs envelope vs 95% energy duration of envelope for 5' rest files. 
- added flow signal to resting pneumotach flow 
- Checked some audits really carefully - does *blip* before exhale considerably affect result?
***** The cleaning may be the issue - does it remove too much of the signal? *****
- Looked at inter-dive IBI for breath counts based on seminar paper for lab meeting
- EXTRACTED 132x DATA FROM TAG! Have to audit in Audition 

13 october
showed this in matlab helpdesk!

---- SMM 2017 ----

6 Nov 
- Renamed all Doug's RW data folders and .dtg to egxxxaxx convention for automation
- Can't audit many of Doug's D2 tags with normal tools as do not have CAL files. BUT have PRH and can therefore just find times to audit in audition
- Backed up all dl and eg tags to AU server 
- Made corrected depth record (tentative prh file) for sw17 deployments. Corrected depth by p*2660-60 as per Mark's recommendation

7 Nov 2017
- Found .xlsx audits for some long DPN eg deployments for BreathCounts. Converted these to cuetab -- DPNauditConvert.m 
- still have to find missed breaths in these deployments. Jerk method underway to detect, but holding off until plans confirmed for mysticete inclusion
- Some auditing of sw17_193a but really tricky...

8 Nov 2017
- intention to look at a few good exercise trials. Chose tt17_139c, then found mismatch between names and logged information. 
These files were offloaded from 401 by Alex Shorter after tag failure, so likely just a renaming issue by accident. Audited all three files from day 139 on tag 401. 
Deduced which file is which, kept names (so as not to confuse things or versions between harddrives). Corrected cal files for all.
- Began to work through Trial17 for MATLAB analysis, have to correct detections for exhalation
- Corrected exhalation times, saved as Trial17_EIcorrected.mat
- Began AlignData_DQ2017 for new file

9 Nov 2017
- aligned tt139b, completed exh-inh audit (on top of normal breath audit)
- REALLY. PRETTY. until intevral >0.1 when things get noisy. EXCELLENT JOB. 
- Matlab analysis for Trial16, corrected detections for exhalation, saved as Trial16_EIcorrected.mat
- Matlab analysis for Trial02, corrected detections for exhalation, saved as Trial02_EIcorrected.mat (on MAC)

10-12 Nov 2017
- Audited and aligned 136a, 138c. All Matlab Analysis for good 401 trials where Pneumo corrected. Coloured by distance from tag. 
- Plotted all 5' rest and ET aligned to date, coloured by distance from blowhole, comparing channels 1 and 2
- plotCorrStore.m after waterfallBreath_ET.m 

15 Nov 2017
- corrected Trial02 and Trial27 for calibration factors for Lono (now within normal range of flows and volumes)
- looked at integrated sound/cumulative sum (kind of like a sound flow volume loop) to see if helps refine noisy breaths? 
- **There is some issue with the index of each cue for audit (to clean)**
- PRH for 144b, 143c
- Lono Trial 43 have to do in two parts: compile after Matlab analysis of pneumotach data

16 Nov 2017
- fixed CUE_R(I(i)) business - still a confusing index system, but unsure what to do with it otherwise. 
- added prediction step for pneum on and pneum off
- VO2estEffect.m: what is the effect of including sound in our estimates of metabolic rate? compare with coarse estimates versus estimates from tidal volume measured
- NEXT STEP: consider this through TIME to get metabolic RATE instead of oxygen PER BREATH. 

17 Nov 2017
- applied VO2estEffect to files 16:27. Have to refine audit of file 27 still
- assessed 'improvement' over constant estimates

20-21 Nov 2017: WHOI Application

22 Nov 2017
- started TAG repository: all tag stuff, including license information from Mark Johnson. 
- Intention is to use this to share files with lab group and set up environment to exchange useful pieces of code, common analyses, etc.

23 Nov 2017
- CUE for File 27 was mixed up, fixed, great improvement to fit (obviously!). A good test to know that correlation does not work when breath alignment is effectively randomized.
- Check CUE alignment for File 24: also has poor correlation - wasn't the issue but some breaths weren't cropped just right
- VO2estEffect for file 24, 27 work well. Now we can quantify by how much sound improves our estimate of VT, especially how it varies through time.

27 Nov 2017
- VO2esteffect visualization improvements and then PresentationTimeline.m to go through the steps of presenting method at SMRU
- Looked back at which deployments in Sarasota we have info on: started waterfallBreathSarasota.m but need acoustics

28 Nov 2017
- Looked at applying waterfallBreath to Sarasota 2014 files where we have flow and sound completed. Not a great relationship for two files 
- Alternative is to use cleanbreath_fun but that seems to overfilter... 
- Met with Laia for updated porpoise audits, short finned pilot whale data and audits
- Met with Pernille for sperm whale click detection for her Part A 
- Included all new harbour porpoise data in countdataload. Added a criteria for  > 7h
- Added humpbacks as entries > 100

29 Nov 2017
- incorporated prediction interval into time plots of measured and sound-estimated tidal volume in a trial
- improved figs (VO2estEffect, Presentationtimeline)
- calculated difference in total VT between methods (VO2estEffect)

30 Nov 2017
- looked back at chest band files. Trial 61: re-audited for exhalation only
- Trial 22: re-audited for exhalation only
- Improved figures 
- Found bug in the matching of indices between band and no pneum. Still just trying to get this to work nicely and to make sense of indices upon indices.

11 Dec 2017
- spent last week in St Andrews doing FHL and Sarasota ECG stuff
- commented and updated the last ECG code to share with Julie Oswald
- checked hyperoodon data from pat3100rick miller 
- killer whale data are all very short...
- finished auditing a sperm whale from azores

13 Dec 2017
- yesterday used respdetector on tt14_127a and checking through detected (and missed) breaths slowly. Stopped at 18215 s (18 h deployment!)
- BreathSounds figure for lab meeting 14 Dec 2017. VO2estEffect and PresentationTimeline adjusted plotting, calculating RMSE for constant TLC VT estimation

14-17 Dec 2017
- Finished tt14_127a with resp detector and full check of data. 
- Checked that bat repository works -- share with Laura [ok actually it doesn't. I can't clone it...]

18 Dec 2017
- Chose gm datasets to round out n = 10 for breathcounts.
- started gm11_250b with automatic detector and then follow-up, stopped at 3100. 
- included all data from Paolo Segre for blue whales, minke whales, fin whales 
- added belugas into countdataload structure
- worked with laura on bat tag: can't see much, maybe something at 4Hz but difficult to decipher so will plan on proper camera protocol in future
- changed some harddrives around so as to only bring *one* back to Vancouver over the holidays 

2-4 Jan 2018
- finished tt15_134a audit for breath counts and breath sounds example
- finishged gm audit for breath counts
- started to look at tt15_134a free breaths: how many, what is pneumm on relationship, how many usable otherwise. 
- looked at a few beluga tags, have to unpack dl16_138a 
- Snow Crab whale code: refresher, reformulation of some of the code for GoSL mapping. Trying to set up github by whyyyyy so difficult lately?

8 Jan 2018
- Writing BreathSounds MS...
- Changed VT estimtae method to use Kooyman as Wahrenbrock method specific to gray whales (less appropriate)
- Looked at Chest Band again (may be the death of me). Still bug in indexing... 

10 Jan 2018
- Chest Band: started anew, without order sorting. This is good, but the message is still unclear. ChestBand_Jan2018.m

11 Jan 2018
- incorporated error into ChestBand figures, showing mostly overlapping CIs. ChestBand_Jan2018.m
- Looked at syringe calibration work: AlignData_SyringeCal.m to pull in syringe data and volume-flow for when pneum on and off. Need to audit second tag in this dataset still. 
- Compared SL in different bands for syringe *breaths* as suggested by Peter: maybe more robust, less sensitive than AUC to e.g. splashes etc. 
- Audited tt147z which has 10-22cm distances with pneumotach on and off. 

12 Jan 2018
- Tried SL with Trial16 -- ET_SL.m. Not as clear, unfortunately
- Added error and TLC to PresentationTimeline 
- Started looking at corrstore again to see how much Sint1, Sint2 differ between trials
- Audited 152b for soundcal 

16 Jan 2018
- AlignData_SyringeCal147z: pulls in all scal for tt147z, plots all spectrograms ranked with flow, assesses pneumo on-off with linear models
- Question remains: calculating or averaging SL correctly? 

17 Jan 2018:
- We are calculating SL ok. We can average it. 
- script to find chunks of breath with high kurtosis to remove these from calculating spectrum
- stuck on ranking spectrum waterfall because unsure of y values for kristian's code
- fixed some issues in SnowCrab simulation and have whales swimming quickly now :) 

18 Jan 2018
- clean spectra for regular files and for syringe (to remove 'click')
- met with Kristian to look at spectra, bandwidths, etc
- removing click improves SLhigh-SLlow-flow correlations marginally

19 Jan 2018
- met with Kristian and Peter. 
- Found optimal bands for high-low comparison (optimalBands.m) for regular files and also for syringe. R2 much better for syringe...
- Did 3d PSD plot for syringe 
- HPF signal inside kurtosis before finding the bad chunks improves detection, but still cuts out a lot. Next step: find peak in kurtosis chunk and cut out smaller amount, or add amplitude criterion
- working on CleanSpectra to do this.

20 Jan 2018
- Added Beluga metadata to countadaload.m 
- Saved Fleur's 3 Zc tags to .txt audit folder

22 Jan 2018
- FFt filter to try to remove syringe sound (fftsyringe.m)
- Improved kurtosis removal of max and some time around it
- Sintegral interpolated to try to improve breaths with impulse sounds 

23 Jan 2018
- plot to show envelope of each integrated sound plot
- 3d plot for filtered sound vs measured VT and flow rate 
- optimalbands + LM based on integrated sound and difference between high/low

24 Jan 2018
- Fixed file 22 timing problem (resaved, corrected EI, realigned, etc)
- With cleanspectra, go through exercise trials and use LM and plot results and fit (CleanSpectra.m)
- plot3tomesh to take three vectors and make a surface (WOO HOO!)
- Fixed file 17 timing problem
- Need to check file 26 VT (really high)

25 Jan 2018
- fixed breath tidal volumes for file 26 (but not a great file...)
- applied predictions to when files have clean spectra 
- compared dolphin versus syringe data in terms of are max and min flow rates representative of actual data? SyringeDolphinCompare.m
- Updated VO2estEffect for cleanspectra output 

26 Jan 2018
- Read some human papers. Went back to the cross-correlation idea in order to actually calibrate flow+sound relationship and use that for other breaths where we don√∏t have the full signal.
- Applied power model because of the physics involved. 
- Looked at waterfallBreathSarasota.m to see how many Sarasota files work, what correlation is. 
- Met with K and P, some direction in terms of important and relevant questions: 
        - what is variation in Sint for Sarasota vs. DQ? 
        - If VT is so constant at rest, then we would expect sound to be constant too (is it)? 
        - include breath duration in LM? 
- went back to FlowSoundPlot.m and also fit gaussian inside that to look at flow+sound relationship.

29 Jan 2018
- tried cross-correlation on file 4 from DQ2013. Other DQ files need to be (re?)aligned for some reason
- can get good flow-sound correlation for exhales but not so much for inhales. 
- looked at BreathQualityLoop for sarasota file, set up loop for breath quality. 

30 Jan 2018
- Fixed cleanSpectra kurtosis issue (was including max values from the bad sections)
- reaudited a few ETs to check on extra short or long breaths
- included duration in linear models, also did a custom power curve fit and compared RMSE and R2 for those 
- 200 in to breathqualityloop for sarasota file tt14_128a. 
- incorporated cleanspectra into Pxx, Fcent calculations (BreathParams)

31 Jan 2018
+ Audited tt14_128a further, moved indices to be able to also quality check the pneumotach and pre-release breaths 
+ (ShiftParams.m)
+ FlowSoundPlot_Sarasota to look at those breaths and whether or not we can do a one-breath calibration. there is some LF thing going on.
+ FlowSoundPlot for DQ file from 2013 updated, estimating flow rate reasonably, then integrating that we can get VT +- 17% on average for exhales
+ inhales in that Sarasota file look good! 

1-2 Feb 2018
+ templatefilter to try to filter out LF sound in sarasota file (tt14_128a_filterseg)

5 Feb 2018
+ What files have the bad sound? Tag 107.
+ Worked on Sarasota file 12 instead - doesnt have bad sound
+ See summary of files at BreathSounds Data google sheet
+ DQ file free-swim envelope estimation: non pneum, resting breaths. swimming breaths. used inhale cues from BreathQualityLoop 

6 Feb 2018
+ met with Peter and Kristian - good progress, time to wrap this up.
+ Github and slack tutorial with Frants and Heidi
+ Frants said hadn't looked into electrical noise filtering but aware of it. 
+ applied relationship to resting and free-swimming breaths for DQ2013 file 4. 
+ looking through and realigning DQ2013 files to be sure things are ok. Found mismatch for file 3. GO BACK TO RAW DATA ON THIS ONE.

7 Feb 2018
+ checked all DQ2013 files, realigned, checked CUES, etc
+ many changes in FlowSoundPlot in terms of order in which things are calculated, preallocation to maintain consistent length of vectors
+ went through all DQ2013 files to see which ones BreathQualityLoop good, ran FlowSoundPlot on those ones. Made a great to-do list.


